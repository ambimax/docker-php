schemaVersion: "2.0.0"

globalEnvVars:

metadataTest:
  env:
    - key: PHP_ENABLE_XDEBUG
      value: false
  labels:
    - key: 'maintainer'
      value: 'Tobias Schifftner <ts@ambimax.de>'
  entrypoint: ["/usr/local/bin/entrypoint.sh"]
  cmd: ["bash"]
  workdir: "/var/www/htdocs"

commandTests:
  - name:  "check php version"
    command: "php"
    args: ["--version"]
    expectedOutput:
      - PHP
      - 7.2.
      - cli
      - OPcache

  - name:  "check git"
    command: "git"
    args: ["--version"]
    expectedOutput:
      - git version

  - name:  "check mysql"
    command: "mysql"
    args: ["--version"]
    expectedOutput:
      - mysql

  - name:  "check redis-cli"
    command: "redis-cli"
    args: ["-v"]
    expectedOutput:
      - redis-cli

  - name:  "check composer"
    command: "composer"
    args: ["--version"]
    expectedOutput:
      - Composer version

  - name:  "check n98-magerun"
    command: "n98-magerun"
    args: ["--version"]
    expectedOutput:
      - n98-magerun

  - name:  "check modman"
    command: "modman"
    args: ["--version"]
    expectedOutput:
      - Module Manager version

  - name:  "check zettr"
    command: "zettr"
    args: ["--version"]
    expectedOutput:
      - Zettr version

  - name:  "check php extensions"
    command: "php"
    args: ["-m"]
    expectedOutput:
      - apcu
      - bcmath
      - calendar
      - ctype
      - curl
      - dom
      - exif
      - fileinfo
      - ftp
      - gd
      - gettext
      - hash
      - iconv
      - igbinary
#      - imagick
      - intl
      - json
      - libxml
      - lzf
      - mbstring
      - memcached
      - mysqli
      - mysqlnd
      - openssl
      - PDO
      - pdo_mysql
      - pdo_sqlite
      - Phar
      - redis
      - Reflection
      - session
      - SimpleXML
      - soap
      - sockets
      - SPL
      - sqlite3
      - standard
      - tidy
      - tokenizer
      - xml
      - xmlreader
      - xmlrpc
      - xmlwriter
      - xsl
      - Zend OPcache
      - zip
      - zlib



fileExistenceTests:
  - name: 'n98-magerun'
    path: '/usr/local/bin/n98-magerun'
    shouldExist: true
    isExecutableBy: 'group'

  - name: 'composer'
    path: '/usr/local/bin/composer'
    shouldExist: true
    isExecutableBy: 'group'

  - name: 'mhsendmail'
    path: '/usr/local/bin/mhsendmail'
    shouldExist: true
    isExecutableBy: 'group'

  - name: 'modman'
    path: '/usr/local/bin/modman'
    shouldExist: true
    isExecutableBy: 'group'

  - name: 'zettr'
    path: '/usr/local/bin/zettr'
    shouldExist: true
    isExecutableBy: 'group'



fileContentTests:
  - name: 'php.ini'
    path: '/usr/local/etc/php/conf.d/zz-php.ini'
    expectedContents:
      - 'sendmail_path \= "\/usr\/local\/bin\/mhsendmail --smtp-addr=\\"mailhog:1025\\""'
